<div class="content_header" id="profile_header">
	<table>
		<tr>
			<td>
				<h1>
					<%=h @user.display_name %> <span class="points">(<%= @user.points %> points)</span>
					<% if my_page? %>
						<span class="action_icon"><%= link_to image_submit_tag("../../images/pencil.png", :class => "action_icon tip", :title => "edit profile", :alt => "edit profile", :onmouseover => "this.src='../../images/pencil_on.png'", :onmouseout => "this.src='../../images/pencil.png'"), edit_user_path(current_user) %></span>
					<% end %>
				</h1>
				<div id="bio">
					<p><%=h @user.bio %></p>
				</div>
			</td>
		</tr>
	</table>
</div>

<div class="content" id="profile">

	<div class="left_column">
	
		<div id="profile_stats">
			<p><% if my_page? %>You've<% else %><%=h @user.display_name %> has<% end %> logged <span class="your_number"><%= link_to number_to_short_time(@total_time), user_workouts_path(@user) %></span><span class="title_unit">h</span> across <span class="your_number"><%= link_to @workouts.size, user_workouts_path(@user) %></span> workout<% if !(@workouts.size == 1) %>s<% end %>.</p>
		</div>

		<div id="achievements" class="achievements">
			<h2>Achievements</h2>
			<% if my_page? && @accomplishments.size == 0 && @workouts.size == 0 %>
			<div class="usage_tip">You have not earned any achievements yet. <%= link_to "Upload your first workout", user_workouts_path(@user) %> to earn points and move up to Novice.</div>
			<% elsif my_page? && @accomplishments.size == 0 && @workouts.size > 0 %>
			<div class="usage_tip">You have not earned any achievements. <%= link_to "Upload workouts", user_workouts_path(@user) %> to earn achievements and points.</div>
			<% elsif @accomplishments.size == 0 %>
			<p><%=h @user.display_name %> has not earned any achievements yet.</p>
			<% else %>
			<ul>
				<%= render :partial => @accomplishments, :locals => { :date => true } %>
			</ul>
			<% end %>
		</div>

		<div id="leaderboards">

			<% if (my_page? || !any_private?) && @workouts.size > 0 %>
				<h2>Personal bests</h2>
			
				<% if @farthest.size > 0 %>		
				<div class="leaderboard toggle">
					<div class="activity_headline">
						<h3><img src="../images/road.png" class="icon">
							Farthest: <span class="number_top"><%=h @farthest.first.distance_in_miles %></span><span class="unit">miles on <%=h time_as_date(@farthest.first.start_time) %></span></h3>
					</div>
					<div class="more">
						<div class="bests">
							<ol>
								<% for workout in @farthest %> 
									<li><span class="number"><%=h workout.distance_in_miles %></span><span class="unit">miles</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
								<% end %>
							</ol>
						</div>
					</div>
				</div>
				<% end -%>	
			
				<% if @fastest.size > 0 %>		
				<div class="leaderboard toggle">
					<div class="activity_headline">
						<h3><img src="../images/flag.png" class="icon">
							Fastest: <span class="number_top"><%= h speed_to_pace(@fastest.first) %></span><span class="unit"><%=h units(workout,:speed) %> on <%=h time_as_date(@fastest.first.start_time) %></span></h3>
					</div>
					<div class="more">
						<div class="bests">
							<ol>
								<% for workout in @fastest %> 
									<li><span class="number"><%=h speed_to_pace(workout) %></span><span class="unit"><%=h units(workout,:speed) %></span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
								<% end %>
							</ol>
						</div>
					</div>
				</div>
				<% end -%>	
			
				<% if @longest.size > 0 %>		
				<div class="leaderboard toggle">
					<div class="activity_headline">
						<h3><img src="../images/clock.png" class="icon">
							Longest: <span class="number_top"><%=h number_to_short_time(@longest.first.duration) %></span><span class="unit">h on <%=h time_as_date(@longest.first.start_time) %></span></h3>
					</div>
					<div class="more">
						<div class="bests">
							<ol>
								<% for workout in @longest %> 
									<li><span class="number"><%=h number_to_short_time(workout.duration) %></span><span class="unit">h</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
								<% end %>
							</ol>
						</div>
					</div>
				</div>
				<% end -%>	
			
				<% if @climbers.size > 0 %>		
				<div class="leaderboard toggle">
					<div class="activity_headline">
						<h3><img src="../images/peaks.png" class="icon">
							Elevation Gain: <span class="number_top"><%=h @climbers.first.elevation_in_feet %></span><span class="unit">ft on <%=h time_as_date(@climbers.first.start_time) %></span></h3>
					</div>
					<div class="more">
						<div class="bests">
							<ol>
								<% for workout in @climbers %> 
									<li><span class="number"><%=h workout.elevation_in_feet %></span><span class="unit">ft</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
								<% end %>
							</ol>
						</div>
					</div>
				</div>
				<% end -%>	
			
				<% if @heart_pumping.size > 0 %>		
				<div class="leaderboard toggle">
					<div class="activity_headline">
						<h3><img src="../images/heart.png" class="icon">
							Heart-pumping: <span class="number_top"><%=h @heart_pumping.first.hr %></span><span class="unit">bpm on <%=h time_as_date(@heart_pumping.first.start_time) %></span></h3>
					</div>
					<div class="more">
						<div class="bests">
							<ol>
								<% for workout in @heart_pumping %> 
									<li><span class="number"><%=h workout.hr %></span><span class="unit">bpm</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
								<% end %>
							</ol>
						</div>
					</div>
				</div>
				<% end %>
			
			<% elsif @workouts.size > 0 %>
			
				<h2>Shared personal bests</h2>
					<% if @farthest_public.size > 0 %>		
					<div class="leaderboard toggle">
						<div class="activity_headline">
							<h3><img src="../images/road.png" class="icon">
								Farthest: <span class="number_top"><%=h @farthest_public.first.distance_in_miles %></span><span class="unit">miles on <%=h time_as_date(@farthest_public.first.start_time) %></span></h3>
						</div>
						<div class="more">
							<div class="bests">
								<ol>
									<% for workout in @farthest_public %> 
										<li><span class="number"><%=h workout.distance_in_miles %></span><span class="unit">miles</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
									<% end %>
								</ol>
							</div>
						</div>
					</div>
					<% end -%>	
			
					<% if @fastest_public.size > 0 %>		
					<div class="leaderboard toggle">
						<div class="activity_headline">
							<h3><img src="../images/flag.png" class="icon">
								Fastest: <span class="number_top"><%=h @fastest_public.first.avg_speed_in_mph %></span><span class="unit">mph on <%=h time_as_date(@fastest_public.first.start_time) %></span></h3>
						</div>
						<div class="more">
							<div class="bests">
								<ol>
									<% for workout in @fastest_public %> 
										<li><span class="number"><%=h workout.avg_speed_in_mph %></span><span class="unit">mph</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
									<% end %>
								</ol>
							</div>
						</div>
					</div>
					<% end -%>	
			
					<% if @longest_public.size > 0 %>		
					<div class="leaderboard toggle">
						<div class="activity_headline">
							<h3><img src="../images/clock.png" class="icon">
								Longest: <span class="number_top"><%=h number_to_short_time(@longest_public.first.duration) %></span><span class="unit">h on <%=h time_as_date(@longest_public.first.start_time) %></span></h3>
						</div>
						<div class="more">
							<div class="bests">
								<ol>
									<% for workout in @longest_public %> 
										<li><span class="number"><%=h number_to_short_time(workout.duration) %></span><span class="unit">h</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
									<% end %>
								</ol>
							</div>
						</div>
					</div>
					<% end -%>	
			
					<% if @climbers_public.size > 0 %>		
					<div class="leaderboard toggle">
						<div class="activity_headline">
							<h3><img src="../images/peaks.png" class="icon">
								Elevation Gain: <span class="number_top"><%=h @climbers_public.first.elevation_in_feet %></span><span class="unit">ft on <%=h time_as_date(@climbers_public.first.start_time) %></span></h3>
						</div>
						<div class="more">
							<div class="bests">
								<ol>
									<% for workout in @climbers_public %> 
										<li><span class="number"><%=h workout.elevation_in_feet %></span><span class="unit">ft</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
									<% end %>
								</ol>
							</div>
						</div>
					</div>
					<% end -%>	
			
					<% if @heart_pumping_public.size > 0 %>		
					<div class="leaderboard toggle">
						<div class="activity_headline">
							<h3><img src="../images/heart.png" class="icon">
								Heart-pumping: <span class="number_top"><%=h @heart_pumping.first.hr %></span><span class="unit">bpm on <%=h time_as_date(@heart_pumping_public.first.start_time) %></span></h3>
						</div>
						<div class="more">
							<div class="bests">
								<ol>
									<% for workout in @heart_pumping_public %> 
										<li><span class="number"><%=h workout.hr %></span><span class="unit">bpm</span>: <span class="workout_name"><%= link_to workout.name, workout %></span>, <%= link_to workout.activity.name, activity_path(workout.activity) %> on <%=h time_as_date(workout.start_time) %></li>
									<% end %>
								</ol>
							</div>
						</div>
					</div>
					<% end %>	

			<% elsif my_page? && @workouts.size == 0 %>				
				<div class="usage_tip">You haven't recorded any personal bests yet. How sad... <%= link_to "Upload a workout", new_user_workout_path(current_user) %> to fix that!</div>

			<% elsif !my_page? && @workouts.size == 0 %>
				<p><%=h @user.display_name %> hasn't shared any bests yet.</p>

			<% end %>
	
		</div>

	</div>

	<div id="content_right_column" class="right_column">

		<div id="workouts_feed">
			<h2>Recent workouts</h2>
			<table class="newsfeed">
				<%= render :partial => @workouts, :locals => { :icon => true, :name => true, :date => true, :duration => false, :user => false } %>
			</table>
			<% if my_page? && @workouts.size == 0 %>
				<p>None yet... Better get moving!</p>
			<% elsif @workouts.size == 0 %>
				<p>No shared workouts yet...</p>
			<% else %>
				<p class="more_news"><%= link_to "See all", user_workouts_path(@user) %></p>
			<% end %>
		</div>
		
	</div>

</div>
